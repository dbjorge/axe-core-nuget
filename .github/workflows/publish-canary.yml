name: Publish canary

on:
  push:
    branches:
      - develop

jobs:
  build-and-test:
    uses: ./.github/workflows/build-and-test.yml
    with:
      configuration: release
      version-suffix: "-alpha.${{ github.run_number }}"

  publish-nuget:
    if: github.repository_owner == 'dequelabs' # don't attempt to publish from forks
    environment: nuget-canary
    needs: ["build-and-test"]
    uses: ./.github/workflows/publish-nuget-packages.yml
    secrets:
      NUGET_API_KEY: ${{ secrets.NUGET_API_KEY }}
